\section{Survival Analysis for ML} 
\label{afr_models}

Failure time analysis has been widely explored in other fields~\cite{aft_models}, from medicine to industrial quality control~\cite{ai_medical_imaging,ai_industry,ai_aviation,ai_luggage,ai_security,ai_prison}, but there is very little published research in the context of ML. However, as noted by many researchers~\cite{madry2017towards, carlini_towards_2017, croce_reliable_2020, meyers}, these models are fragile to attackers that intend to subvert the model, steal the database, or evade detection.  \cm{In this work, we leverage evasion attacks to examine the parameterised time-to-failure -- or survival time -- denoted $S_{\theta}(t)$, where $\theta$ is a set of parameters that describe the joint effect of the covariates on the survival time, usually found through maximum likelihood estimation on observed survival data~\cite{collett2023modelling}.} All survival models can be expressed in terms of this parameterised survival function, $S_\theta(t)$, hazard function, $H_\theta(t)$, and lifetime probability distribution, $F_{\theta}(t)$, such that
$$
	S_{\theta}(t) := \exp\big\{-H_{\theta}(t)\big\} := 1 - F_{\theta}(t) := 1 - \int_0^t f_\theta(u) du,
$$
and the expected survival time is thus
$$
	\mathbb{E}_{S_\theta}[T] =  \int_{0}^{t^*} S_{\theta}(u) du \approx t_{\mathrm{attack}}, 
$$
where $t_{\mathrm{attack}}$ is an estimate of the time it takes for the average attacker to induce a failure subject to the condition in Equation~\ref{eq:perturbation_distance} \cm{and $t^*$ is the latest observed time (regardless of failure or success)}. The parameters, $\theta$, are estimated from model evaluation data such that: $h_{\theta}(t=t_{attack}) \approx 1 - \mathrm{Acc}_{\mathrm{adv}}$.

Survival analysis models have been widely used to investigate the likelihood of failures across fields where safety is a primary concern (\textit{e.g.}, in medicine, aviation, or automobiles)~\cite{liu2013development,lawless1995methods}. These models allow us to examine the effect of the specified covariates on the failure rate of the classifier. For manufacturing, this is done by simulating normal wear and tear on a particular component (\textit{e.g.}, a motor or aircraft sensor)~\cite{liu2013development} by exposing the component to vibration, temperatures, or impacts. For the study of diseases in humans, these models are often build on demographic data and used to examine the effect of things like age, gender, and/or treatment on the expected survival time of a patient. 
Likewise, survival analysis can be used to estimate the time until a successful adversarial attack of an ML pipeline or component using metrics that are routinely collected as part of normal model training procedures. The covariates, for example, might be things like perturbation distance, model depth, number of training epochs, a signal processing technique, \textit{etc.}

These survival analysis models can broadly be separated into two categories: proportional hazard models and accelerated failure time models, each of which is outlined in the subsections below. Furthermore, by parameterizing the performance by time, it is possible to do a cost-value analysis, as outlined in Section~\ref{cost_normalization}.


\subsection{The Cox Proportional Hazard Model}
The Cox proportional hazard model tries to find model parameters, $\theta$, corresponding to covariates, $x$, to predict the hazard function on unseen configurations of the covariates, such that
$$
    h_\theta(t) = h_0(t)\phi_\theta(x) = h_0(t) \exp(\theta_1 x_1 + \theta_2 x_2 + \cdots + \theta_p x_p), 
$$
where $\theta_i$ is the $i$-th model parameter and $x_i$ is the measurement of the $i$-th covariate. One downside of the Cox model compared to the accelerated failure time models discussed below is that there are few distributions that fit the proportional hazards assumption. A common choice is therefore to use a non-parametric approximation of the baseline hazards function~\cite{collett2023modelling}.
Additionally, unlike the accelerated failure time models discussed below, the coefficients in the Cox model, $\theta$, are interdependent (they are said to be \textit{adjusted} for each other) and, as such, their interpretation is not straightforward~\cite{collett2023modelling}.

\subsection{Accelerated Failure Time Models}
While Cox models assume that there is a multiplicative factor on the baseline hazard function, $h_0$, due to effect of a covariate, accelerated failure time (AFT) models instead assume that the effect of a covariate is to accelerate or decelerate the time in a baseline survival function, $S_0(t)$. 
Accelerated failure time models have the form
\begin{equation} \label{eq:def_aft_model}
	S_\theta(t) = S_0 \left( \frac{t}{\phi_\theta(x)} \right),
\end{equation}
where $\phi_\theta$ is an \textit{acceleration factor} that depends on the covariates, and typically $\phi_\theta(x) =  \exp(\theta_1 x_1 + \theta_2 x_2 + \cdots + \theta_p x_p)$. The $S_0$  is the baseline survival function, and $\theta_i$ is the $i$-th acceleration factor associated with the value of the corresponding covariate, $x_i$. Common choices for parametric AFT models are listed below. Unlike the proportional hazard model discussed above, the coefficients of AFT models have a straightforward interpretation where a value of $N$ represents an $N$-fold increase in failure risk~\cite{collett2023modelling} and a negative value indicates a corresponding decrease in failure risk. 


\subsubsection{Exponential}
The simplest AFT model of the hazard function is one that assumes a constant value over time,
$$
    h(t) = \lambda,
$$
where $\lambda$ is the false classification rate and $t$ is time. The survival time for the exponential model can be expressed as in Equation~\ref{eq:def_aft_model} when $\phi_\theta(x) = \exp \left( \theta_1 x_1 + \theta_2 x_2 + \cdots + \theta_p x_p \right) $ and 
$$ 
    S_0(t) = \exp(-\lambda t),
$$
and if we divide $t$ by $\phi_\theta$ (letting $\phi_\theta$ consume $\lambda$), we obtain Equation~\ref{eq:def_aft_model}.





\subsubsection{Weibull}
% Translating from 5.12.1 in Collett 2023
% Theirs --> ours
% gamma --> sigma
% lambda --> lambda
Weibull models are flexible AFT models that assume the survival times, $T$, follow a Weibull distribution, as
$$  % Collett pg. 198, line 7
    T \sim \mathcal{W}(\lambda, \sigma),
$$
where $\lambda$ and $\sigma$ are scale and shape parameters of the Weibull distribution, respectively. In the Weibull AFT model, the baseline survival function is
$$ %2 Equations after 5.66 Collett
    S_0(t) = \exp( -(\lambda t)^{\frac{1}{\sigma}}).
$$
Let  
$$
    \phi_\theta(x) = \exp( \theta_1 x_1 + \theta_2 x_2 + \cdots + \theta_p x_p ).
$$
Then, the parameterised survival function can be expressed as
$$ % Equation after 5.66 Collett
    S_\theta(t) = \exp \left(- (\phi_\theta(x) t)^{\frac{1}{\sigma}} \right),
$$
letting $\phi_\theta$ consume $\lambda$.



\subsubsection{Log-Normal}
The Log-Normal AFT model assumes that the logarithm of the survival time follows a normal distribution. This model can capture scenarios where the hazard function is not monotonic over time. The logarithm of the survival time $T$ is
$$ % From Tommy's comment, Collet's notation
   \log T \sim \mathcal{N}(\mu, \sigma^2).
$$
with a mean of $\mu$ and a variance of $\sigma^2$.
The baseline survival function is
$$ % First Eq. in 5.12.3
    S_0(t) = 1 - \Phi\left( \frac{\log t - \mu}{\sigma} \right).
$$
Let $\mu=0$ and
$$ % https://www.stata.com/manuals13/ststreg.pdf page 6
    \phi_\theta(x) = \exp(\theta_1 x_1 + \theta_2 x_2 + \cdots + \theta_p x_p),
$$
then we see that
$$ % Equation 5.73 in Collett 2023
    S_{\theta}(t) = 1 - \Phi \left( \frac{\log t  -  \log(\phi_\theta(x))}{\sigma}\right),
$$
where $\Phi$ is the cumulative distribution function of the standard normal distribution.
% Phi defined under 5.10

% DO NOT CHANGE ANYTHING ABOVE THIS LINE

\subsubsection{Log-Logistic}
\cm{
The Log-Logistic AFT model assumes that the logarithm of the survival time follows a logistic distribution. This model is useful for capturing scenarios where the hazard function first increases and then decreases over time. The survival time $T$ is expressed as
$$ % From Tommy's comment, Collet's notation
    \log T \sim \mathcal{L}(\phi_\theta(x), \sigma),
$$
where $\mathcal{L}$ is a standard logistic variable with mean $\phi_\theta(x) = \exp(\theta_1 x_1 + \theta_2 x_2 + \cdots + \theta_p x_p)$ and scale $\sigma > 0$.  The baseline survival function is
$$ % 
    S_0(t) = \left(1 + \exp\left( \frac{\log t - \mu}{\sigma} \right)\right) ^{-1}.
$$
The parameterised survival function for the Log-Logistic can then be expressed as
$$ % Equation after 5.70 in Collett
    S_{\theta}(t) = \left( 1 + \exp \left( \frac{\log t - \mu - \phi_\theta(x)}{\sigma}\right) \right)^{-1}.
$$
}


\subsubsection{Generalised Gamma}
\cm{
The Generalised Gamma AFT model is a flexible model that encompasses several other distributions as special cases, including the Exponential, Weibull, and Log-Normal models. 
The survival function for the Generalised Gamma model is
$$
    S(t) = 1 - F(t) = 1 - \int_0^t f(u) \, du,
$$
The integrand can be expressed in terms of the incomplete Gamma function, $\Gamma_{\theta}$, where
$$
    \Gamma_{\theta}(\rho,z) = \frac{1}{\Gamma(\rho)}\int_0^{z}u^{\rho -1}e^{-u}du.
$$
The probability density function, $f(t)$ is given by
% Translating from section 5.1.6 in Collett 2023:
% Theirs = Ours
% \lambda = \lambda
% \rho = \rho 
% \theta = \beta
$$
    f(t) = \frac{\beta \lambda^{\rho \beta} t^{\rho \beta -1} \exp( -(\lambda t)^\beta)}{\Gamma(\rho)},
$$
where $\lambda > 0$ is a scale parameter, $\rho, \beta > 0 $ are shape parameters, and $\Gamma$ denotes the Gamma function. 
Assuming $\beta > 0$ and $\phi_{\theta}(x) = \theta_1 x_1 + \theta_2 x_2 + \cdots + \theta_p x_p$, the parameterised survival function can be written in terms of the incomplete gamma function defined above
$$
    S_{\theta}(t) = 1 - \Gamma_{\theta}\left(\rho, \left(\lambda \frac{t}{\phi_\theta(x)}\right)^\beta\right).
$$
}

% Replaced with the above
% \subsubsection{Generalised Gamma}
% The generalised gamma model uses three parameters $\sigma, \lambda,\gamma$. Let
% $$
%     u(x,y)= \Gamma \left ( \frac{1}{(\lambda(x, \alpha))^2}; \frac{\exp \left( \lambda(x, \alpha) \left( \frac{log(t) - \mu(\gamma, x)}{\sigma(\beta, y)} \right ) \right) }{(\lambda(x, \alpha))^2} \right )
% $$
% where $\Gamma(k, x)$ is the incomplete Gamma function, $\lambda(x, \alpha) = \alpha x^T$, $\sigma(\beta, y) = \exp(\beta y )$, $\mu(\gamma, x) = \gamma x^T$, and $\theta = (\lambda, \sigma, \mu)$. Then the survival function can be expressed as:
% $$
% S_{\theta}(t; x, y) =
% \begin{cases}
%     1 - u~\text{when}~\lambda > 0 \\
%     u~\text{when}~\lambda \leq 0.
% \end{cases}
% $$

% The exponential, Weibull, and log-normal models outlined below are all special cases of this model~\cite{kleinbaum1996survival}.


% \subsubsection{Exponential Model}

% The exponential survival model can be defined in terms of the cumulative survival function:
% $$
%     S_{\theta}(t; x, y) = \exp \left( -\frac{t}{\lambda_0 \cdot \exp(\beta x + \gamma y)} \right)
% $$
% where $\beta, \gamma$ are the coefficients associated with the vector of covariates, $x$, the vector of failure events, $y$ and $\theta = (\alpha, \beta, \gamma)$

% \subsubsection{Weibull }
% The Weibull function has the form:
% $$
% 	S_\theta(t; x, y) = \exp{\left( - \left( \frac{t}{\lambda(\beta, x)} \right)^{\rho(\alpha, y)} \right)},
% $$
% where $\theta=(\alpha, \beta)$, $\lambda(\beta, x)=\exp(\beta_0 + \beta_1 x_1 + \cdots + \beta_n x_p)$ is a scale parameter, and $\rho(\alpha, y)=\exp(\alpha_0 + \alpha_1 y_1 + \cdots + \alpha_p y_p)$ is a shape parameter that determines the direction of acceleration over time.

% \subsubsection{Log-Normal }

% The Log-Normal  model introduces the parameters $\mu(\alpha, x) = \alpha_0 + \alpha_1 x_1 + \cdots + \alpha_n x_p $ and $\sigma(\beta, y) = \exp(\beta_0 + \beta_1 y_1 + \cdots + \beta_n y_p)$ with the survival function given by,
% $$
% 	S_\theta(t; x, y) = 1 - \log \left( 1 - \Phi \left (  \frac{\log(t) - \mu(\alpha, x) }{ \sigma(\beta, y) } \right) \right).
% $$



% \subsubsection{Log-Logistic }

% Another form of the  model, the Log-Logistic , introduces the scale and shape parameters $a(\alpha, x) = \exp(\alpha_0 + \alpha_1 x_1 + \cdots + \alpha_n x_p )$ and $b(\beta, y) = \exp(\beta_0 + \beta_1 y_1 + \cdots + \beta_n y_p)$, respectively, with survival function,
% $$
% 	S_\theta(t; x, y) = 1 - \log \left( 1 + \left (  \frac{t - a(\alpha, x) }{ b(\beta, y) }\right)\right),
% $$
% where $\theta = (\alpha, \beta)$.



\subsection{Survival Model Validation}
\label{metrics}

To compare the efficacy of different parametric AFT models, we use the Akaike information criterion (AIC) and the Bayesian information criterion~\cite{stoica2004model,taddy2019business}, where the preferred model will be the one with the smallest value. We provide the
concordance score, which gives a value between $0$ and $1$ that quantifies the degree to which the survival time is explained by the model, where a $1$ reflects a perfect explanation~\cite{kleinbaum1996survival}, 0.5 reflects random chance. We also include graphical calibration curves (see Figure~\ref{fig:afr_models}), that depict the relationship between the fitted model (second axis) and a model fit to the data using cubic splines (first axis) as proposed by Austin \textit{et al.}~\cite{ici}. We also measured the mean difference between the predicted and observed failure probabilities (\textit{e.g.}, integrated calibration index or ICI) and the median value of these differences (\textit{e.g.}, the error at the 50th percentile or the E50). \cm{Except for AIC and BIC, we have provided these metrics for both the training and test sets, the latter of which is 20\% of the total number of samples.}


\section{Failure Rates and Cost Normalisation}
\label{cost_normalization}

With an estimate for the expected survival time, the cost-normalised failure rate, or training time to attack time ratio, can be quantified. Under the assumption that the cost scales linearly with $t_{\mathrm{train}}$ (as in Equation~\ref{eq:naive_cost}), one can divide this cost by the expected survival time to get a rough estimate of the relative costs for the model builder ($C_{\mathrm{train}} \propto t_{\mathrm{train}}$) and the attacker ($C_{\mathrm{adv.}} \propto t_{\mathrm{attack}} \approx \mathbb{E}_{S_\theta}[T]$). Recalling the definition of $\varepsilon$ in Equation~\ref{eq:perturbation_distance}, the cost of failure in both benign and adversarial terms can be expressed as,
% the cases $\varepsilon=0$ and $\varepsilon > 0$ can be considered separately, and
% \bar{C}_{\mathrm{ben.}} = \frac{t_{\mathrm{train}}}{\mathbb{E}_{S_\theta}[T \,|\, \varepsilon = 0] }
	\text{~~and~~}
\begin{equation}
	\bar{C}_{\mathrm{adv.}}=\frac{t_{\mathrm{train}}}{\mathbb{E}_{\theta}[T \,|\, 0 < \varepsilon \leq \varepsilon^*]}.
	\label{eq:cost}
\end{equation}
If $\bar{C} \gg 1$ (in either case) then the model is \textit{broken} since it is cheaper to attack the model than it is to train it. 
\cm{We call this metric the TRASH score since it quickly indicates whether more training is likely to improve the adversarial robustness and any score $ > 1$ indicates that a given model is, in fact, irredeemable and can therefore be immediately discarded. The numerator can be thought as the approximate training time per sample, or \textbf{t}raining \textbf{r}ate, and the denominator is the expected \textbf{s}urvival \textbf{h}euristic. Their ratio allows one to quantify the comparative cost of the model builder and the attacker and the coefficients of the survival model provide a way to estimate the asymptotic effects of our covariates.}

% Also, by treating $\varepsilon$ as a covariate in ${S_\theta}$, these costs can be computed directly from a single survival model, using $t_{\mathrm{attack}}=t_{\mathrm{predict}}$ and $\varepsilon \rightarrow 0$.

